import"./index-Dob3nYDb.js";import{D as n}from"./dto-mapper-BfqElrW5.js";import"./Video-CZb525El.js";import"./Transcript-CIaTKO-4.js";import"./Highlight-wkXLIbi7.js";import"./VideoMetadata-CaYyTJPb.js";class d{constructor(t){this.browserStorage=t}transcripts=new Map;async save(t){try{this.transcripts.set(t.id,t);const r=this.browserStorage.getSessionId(),s=n.transcriptEntityToPersistenceDto(t,r);await this.browserStorage.saveTranscript(s)}catch(r){console.warn("TranscriptRepository: 儲存轉錄時發生錯誤",{transcriptId:t.id,videoId:t.videoId,error:r instanceof Error?r.message:String(r)})}}async findById(t){try{const r=this.transcripts.get(t);if(r)return r;const s=await this.browserStorage.restoreTranscript(t);if(!s)return null;const e=n.transcriptPersistenceDtoToEntity(s);return this.transcripts.set(t,e),e}catch(r){return console.warn("TranscriptRepository: 查找轉錄時發生錯誤",{transcriptId:t,error:r instanceof Error?r.message:String(r)}),null}}async findByVideoId(t){try{for(const e of this.transcripts.values())if(e.videoId===t)return e;const r=await this.browserStorage.restoreTranscriptByVideoId(t);if(!r)return null;const s=n.transcriptPersistenceDtoToEntity(r);return this.transcripts.set(s.id,s),s}catch(r){return console.warn("TranscriptRepository: 按視頻 ID 查找轉錄時發生錯誤",{videoId:t,error:r instanceof Error?r.message:String(r)}),null}}async delete(t){this.transcripts.delete(t)}async clear(){this.transcripts.clear()}async findAll(){return Array.from(this.transcripts.values())}}export{d as TranscriptRepositoryImpl};
