import{c as a,b as p,T as m,a as o,S as T}from"./Transcript-CIaTKO-4.js";import{V as h}from"./VideoNotFoundError-Cuq1j19V.js";import{A as y}from"./ApplicationError-C71rmzjz.js";import{b as f}from"./id-generator-CM2YM-lZ.js";import"./index-cBR94Rst.js";class s extends y{constructor(t){super(`Transcript generation failed: ${t}`,"TRANSCRIPT_GENERATION_FAILED"),Object.setPrototypeOf(this,s.prototype)}}class l{constructor(t,e,r){this.transcriptGenerator=t,this.transcriptRepository=e,this.videoRepository=r}async execute(t){if(!await this.videoRepository.findById(t))throw new h(t);let r;try{r=await this.transcriptGenerator.generate(t)}catch(i){const c=i instanceof Error?i.message:"Unknown error";throw new s(c)}const n=this.convertToEntity(r);return await this.transcriptRepository.save(n),n}convertToEntity(t){const e=t.sections.map(n=>this.convertSectionToEntity(n)),r=f();return new a(r,t.videoId,e,t.fullText)}convertSectionToEntity(t){const e=t.sentences.map(r=>this.convertSentenceToEntity(r));return new p(t.id,t.title,e)}convertSentenceToEntity(t){const e=new m(o.fromSeconds(t.startTime),o.fromSeconds(t.endTime));return new T(t.id,t.text,e,t.isHighlightSuggestion)}}export{l as ProcessTranscriptUseCase};
